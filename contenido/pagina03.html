<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página 01 | I4L</title>
</head>
<body class="pagina-interna">
    <img class="elementos" id="fondo" src="./img/pagina03/fondo.png" data-posX="0" data-posY="0" alt="">
    <img class="elementos" id="titulo" src="./img/pagina03/titulo.png" data-posX="0" data-posY="0" alt="">
   
    <img class="elementos" id="info01" src="./img/pagina03/img01.png"  data-posX="0" data-posY="0" alt="">
    <img class="elementos" id="info02" src="./img/pagina03/img02.png"  data-posX="0" data-posY="0" alt="">
    <img class="elementos" id="info03" src="./img/pagina03/img03.png"  data-posX="0" data-posY="0" alt="">
    <img class="elementos" id="info04" src="./img/pagina03/img04.png"  data-posX="0" data-posY="0" alt="">
    <img class="elementos" id="info05" src="./img/pagina03/img05.png"  data-posX="0" data-posY="0" alt="">

    <img class="elementos" id="paloma" src="./img/pagina03/paloma.png" data-posX="0" data-posY="0" alt="">
    <img class="elementos" id="tache" src="./img/pagina03/tache.png" data-posX="0" data-posY="0" alt="">
    

    <div class="elementos drop boton" id="drop1" data-id="1" data-posX="482.395" data-posY="103.499" style="width:507.733px;  height:415.466px;"></div>
    <div class="elementos drop boton" id="drop2" data-id="2" data-posX="482.395" data-posY="103.499" style="width:507.733px;  height:415.466px;"></div>
    <div class="elementos drop boton" id="drop3" data-id="3" data-posX="482.395" data-posY="103.499" style="width:507.733px;  height:415.466px;"></div>
    <div class="elementos drop boton" id="drop4" data-id="4" data-posX="482.395" data-posY="103.499" style="width:507.733px;  height:415.466px;"></div>
    <div class="elementos drop boton" id="drop5" data-id="5" data-posX="482.395" data-posY="103.499" style="width:507.733px;  height:415.466px;"></div>
    <div class="elementos drop boton" id="drop6" data-id="6" data-posX="482.395" data-posY="103.499" style="width:507.733px;  height:415.466px;"></div>

    <div class="elementos drop boton" id="drop7" data-id="7" data-posX="29.453"  data-posY="104.23" style="width:190px;  height:211.939px;"></div>
    <div class="elementos drop boton" id="drop8" data-id="8" data-posX="217.88"  data-posY="104.23" style="width:190px;  height:211.939px;"></div>
    <div class="elementos drop boton" id="drop9" data-id="9" data-posX="408.332" data-posY="104.23" style="width:190px;  height:211.939px;"></div>
    <div class="elementos drop boton" id="drop10" data-id="10" data-posX="28.5"    data-posY="330"    style="width:190px;  height:211.939px;"></div>
    <div class="elementos drop boton" id="drop11" data-id="11" data-posX="218.554" data-posY="330"    style="width:190px;  height:211.939px;"></div>
    <div class="elementos drop boton" id="drop12" data-id="12" data-posX="408.039" data-posY="330"    style="width:190px;  height:211.939px;"></div>

    <img class="elementos drag" id="drag1" data-id="1" src="./img/pagina03/drag1.png" data-posX="31.65 "   data-posY="210" alt="">
    <img class="elementos drag" id="drag2" data-id="2" src="./img/pagina03/drag2.png" data-posX="126.654 " data-posY="212" alt="">
    <img class="elementos drag" id="drag3" data-id="3" src="./img/pagina03/drag3.png" data-posX="236.335 " data-posY="210" alt="">
    <img class="elementos drag" id="drag4" data-id="4" src="./img/pagina03/drag4.png" data-posX="364.949"  data-posY="212" alt="">
    <img class="elementos drag" id="drag5" data-id="5" src="./img/pagina03/drag5.png" data-posX="130.84 "  data-posY="302.068" alt="">
    <img class="elementos drag" id="drag6" data-id="6" src="./img/pagina03/drag6.png" data-posX="249.73 "  data-posY="303.807" alt="">

    <img class="elementos drag" id="drag7" data-id="7" src="./img/pagina03/drag7.png" data-posX="10 " data-posY="399.626" alt="">
    <img class="elementos drag" id="drag8" data-id="8" src="./img/pagina03/drag8.png" data-posX="260" data-posY="401.366 " alt="">
    <img class="elementos drag" id="drag9" data-id="9" src="./img/pagina03/drag9.png" data-posX="360" data-posY="404.547 " alt="">
    <img class="elementos drag" id="drag10" data-id="10" src="./img/pagina03/drag10.png" data-posX="120 " data-posY="401.366 " alt="">
    <img class="elementos drag" id="drag11" data-id="11" src="./img/pagina03/drag11.png" data-posX="367.345 " data-posY="303.214 " alt="">
    <img class="elementos drag" id="drag12" data-id="12" src="./img/pagina03/drag12.png" data-posX="18.01" data-posY="303.807 " alt="">
    

    <img class="elementos " id="botonValidar"  src="./img/pagina03/botonVerificar.png" data-posX="756.283" data-posY="465.609" alt="">
    <img class="elementos " id="avanzar"  src="./img/pagina03/avanzar.png" data-posX="830" data-posY="465.609" alt="">
    <img class="elementos " id="retroBien"  src="./img/pagina03/retroBien.png" data-posX="0" data-posY="0" alt="">
    <img class="elementos " id="retroMal"  src="./img/pagina03/retroMal.png" data-posX="0" data-posY="0" alt="">
    <img class="elementos " id="botonReintentar"  src="./img/pagina03/btnReintentar.png" data-posX="300" data-posY="470" alt="">
    <img class="elementos " id="siguiente"  src="./img/pagina03/siguiente.png" data-posX="926.955 " data-posY="480.781 " alt="">


    <!-- Script de la página -->
    <script type="module">

        // Importaciones---------------------------------------------------
        import {aplicacion} from './js/app.js';
        import {cargando} from './js/funciones.js';
        import {animacionEntrada, parpadea, animacionSalida} from './js/animaciones.js';

        // Variables-------------------------------------------------------
        
        const titulo = $('#titulo');
        const robot = $('#robot7');

        const drag1 = $('#drag1');
        const drag2 = $('#drag2');
        const drag3 = $('#drag3');
        const drag4 = $('#drag4');
        const drag5 = $('#drag5');
        const drag6 = $('#drag6');

        const drag7 = $('#drag7');
        const drag8 = $('#drag8');
        const drag9 = $('#drag9');
        const drag10 = $('#drag10');
        const drag11 = $('#drag11');
        const drag12 = $('#drag12');

        const info01 = $('#info01');
        const info02 = $('#info02');
        const info03 = $('#info03');
        const info04 = $('#info04');
        const info05 = $('#info05');
        const paloma = $('#paloma');
        const tache = $('#tache');
        const botonValidar = $('#botonValidar');
        const retroBien = $('#retroBien');
        const retroMal = $('#retroMal');
        const botonReintentar = $('#botonReintentar');
        const siguiente = $('#siguiente');

        const drop1 = $('#drop1');
        const drop2 = $('#drop2');
        const drop3 = $('#drop3');
        const drop4 = $('#drop4');
        const drop5 = $('#drop5');
        const drop6 = $('#drop6');

        const drop7 = $('#drop7');
        const drop8 = $('#drop8');
        const drop9 = $('#drop9');
        const drop10 = $('#drop10');
        const drop11 = $('#drop11');
        const drop12 = $('#drop12');

        let bloque1 = false;
        let bloque2 = false;
        let contador1= 0;
        let contador2= 0;

        let dropActivoSubstr = "";
        let dragActivoSubstr = ""; 
        let esteIDSubstr ="";

        const elementosDrag = $('.drag');
        const elementosDrop = $('.drop'); 

        let dragSelect;
        let dropCorrespondiente;
            
        let aciertos = 0;

        let minimoPuntuacion = 6;
        let contadorCorrectos = 0;

        // Audio-----------------------------------------------------------
        const audio = [
            new Audio('./audios/R6_03_1.mp3'),
            new Audio('./audios/R6_03_2.mp3'),
            
        ]

        //Al cargar la página
        jQuery(function($){ 
            cargando(iniciarPagina);
        });

        const iniciarPagina = ()=>{
            aplicacion.reproducirAudio(audio[0], ejercicioPag07, 1000);
            animacionEntrada(titulo, 'izquierda-derecha', 1, 1);
            animacionEntrada(info01, 'arriba-abajo', 1, 1);
            animacionEntrada(info02, 'arriba-abajo', 1, 1.5);
        }

        const ejercicioPag07 = ()=>{
            animacionEntrada(drag1, 'arriba-abajo', 1, 1);
            animacionEntrada(drag2, 'arriba-abajo', 1, 1.5);
            animacionEntrada(drag3, 'arriba-abajo', 1, 5);
            animacionEntrada(drag4, 'arriba-abajo', 1, 5.5);
            animacionEntrada(drag5, 'arriba-abajo', 1, 3);
            animacionEntrada(drag6, 'arriba-abajo', 1, 3.5);
            animacionEntrada(drag7, 'arriba-abajo', 1, 6);
            animacionEntrada(drag8, 'arriba-abajo', 1, 6.5);
            animacionEntrada(drag9, 'arriba-abajo', 1, 2);
            animacionEntrada(drag10, 'arriba-abajo', 1, 2.5);
            animacionEntrada(drag11, 'arriba-abajo', 1, 4);
            animacionEntrada(drag12, 'arriba-abajo', 1, 4.5);

            animacionEntrada(drop1, 'default', 1, 1);

            relacionar();
        }

        const relacionar = ()=>{
            elementosDrag.draggable({
                revert: true,
                start: function (event, ui) {
                    dragSelect = $(this).data('id');
                    var esteID = $(this).data("id");
                    console.log("Drag seleccionado: " + esteID);
                    var esteIDSubstr = $(this).attr("id").substr(4, 1);
                    console.log("Drag seleccionado: " + esteIDSubstr);
                    dragActivoSubstr = esteIDSubstr;
                }
            });

            elementosDrop.droppable({
                accept: elementosDrag,
                tolerance: "touch",

                drop: function( event, ui ) {
                    dropCorrespondiente = $(this).data('id');
                    verificar();
                    esteIDSubstr = $(this).attr("id").substr(4, 1);
                    dropActivoSubstr = esteIDSubstr;
                    console.log("colisión con: " + esteIDSubstr);
                }
            });
        }

        const verificar = ()=>{
            let str_dropActivoSubstr = String(dropActivoSubstr);
            let res_dropActivoSubstr = "";

            let str_dragActivoSubstr =  String(dragActivoSubstr);
            let str_dragActivoSubstr2 = 1;
            let str_dragActivoSubstr3 = 1;
            let str_dragActivoSubstr4 = 1;
            let str_dragActivoSubstr5 = 1;
            let str_dragActivoSubstr6 = 1;
            let str_dragActivoSubstr7 = 1;
            let str_dragActivoSubstr8 = 1;
            let str_dragActivoSubstr9 = 1;
            let str_dragActivoSubstr10 = 1;
            let res_dragActivoSubstr = "";

            if (str_dragActivoSubstr == dropCorrespondiente || str_dragActivoSubstr3 == dropCorrespondiente || str_dragActivoSubstr4 == dropCorrespondiente || str_dragActivoSubstr6 == dropCorrespondiente || str_dragActivoSubstr7 == dropCorrespondiente || str_dragActivoSubstr8 == dropCorrespondiente || str_dragActivoSubstr9 == dropCorrespondiente || str_dragActivoSubstr10 == dropCorrespondiente) {
                console.log("ahuevo si entroo tengo: " +str_dragActivoSubstr + "drag");
                let dragActivo = $(`#drag${dragSelect}`);
                let dropActivo = $(`#drop${dropCorrespondiente}`);
                $(this).hide();

                if((dragSelect==1) || (dragSelect==3) || (dragSelect==4) || (dragSelect==6) || (dragSelect==7) || (dragSelect==8) || (dragSelect==9) || (dragSelect==10) ){ 
                    aciertos++;
                    contador1++;                
                    dragActivo.draggable({
                        revert: false,
                    });
                    dragActivo.draggable("disable");
                    dragActivo.css({
                        cursor: 'default'
                    });
                }
                
                bloque1=true;
                console.log("tengo: " + aciertos+ "aciertos");
                console.log("tengo contados: " + contador1+ "contador1");
            }

            if (contador1 >= 8) {
                parpadea(botonValidar);
            }
        }    

        botonValidar.click(function() {
            if ($(this).css('cursor') == 'pointer') {
                TweenMax.killTweensOf($(this));
                $(this).hide();                
                $(this).css({
                    'cursor': 'default',
                    'opacity': '1'
                });

                console.log("tengo: " + aciertos+ "aciertos validados");

                    if (bloque1==true) {
                            if (aciertos == 8) { 
                            aplicacion.terminaPantalla();                      
                            siguiente.hide(); 
                            animacionEntrada(retroBien, 'izquierda-derecha', 1, 1);
                            aplicacion.reproducirAudio(audio[1], aplicacion.terminaPantalla, 2000);
                        }
                        else{
                            siguiente.hide(); 
                            parpadea(botonReintentar);
                        }


                    }
            }    
        });
        
        $("#botonReintentar").click(function() {
            if ($(this).css('cursor') == 'pointer') {
                TweenMax.killTweensOf($(this));
                $(this).css({
                    'cursor': 'default',
                    'opacity': '1'
                });
                aplicacion.recargarPag();
            }    
        });

    </script>

    <!-- Termina Script -->
</body>
</html>