<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página 01 | I4L</title>
</head>
<body class="pagina-interna">
    <img class="elementos" id="fondo" src="./img/pagina07/fondo.png" data-posX="0" data-posY="0" alt="">
    <img class="elementos" id="titulo" src="./img/pagina07/titulo.png" data-posX="0" data-posY="0" alt="">
    <img class="elementos" id="info01" src="./img/pagina07/img01.png"  data-posX="0" data-posY="0" alt="">
    <img class="elementos" id="info02" src="./img/pagina07/img02.png"  data-posX="0" data-posY="0" alt="">

    <img class="elementos" id="paloma" src="./img/pagina07/paloma.png" data-posX="0" data-posY="0" alt="">
    <img class="elementos" id="tache" src="./img/pagina07/tache.png" data-posX="0" data-posY="0" alt="">
    
    <div class="elementos drop boton" id="drop1" data-id="1" data-posX="83.095 "  data-posY="206.111"    style="width:270px;  height:30px;"></div>
    <div class="elementos drop boton" id="drop2" data-id="2" data-posX="53.448 "  data-posY="244.229"    style="width:190px;  height:30px;"></div>
    <div class="elementos drop boton" id="drop3" data-id="3" data-posX="175.493"  data-posY="335.326 "   style="width:190px;  height:50px;"></div>
    <div class="elementos drop boton" id="drop4" data-id="4" data-posX="56.538 "  data-posY="404.149"    style="width:190px;  height:50px;"></div>
    <div class="elementos drop boton" id="drop5" data-id="5" data-posX="218.554"  data-posY="330"        style="width:190px;  height:50px;"></div>
    <div class="elementos drop boton" id="drop6" data-id="6" data-posX="408.039"  data-posY="330"        style="width:190px;  height:50px;"></div>

    <img class="elementos drag" id="drag1" data-id="1" src="./img/pagina07/drag1.png" data-posX="600.91 " data-posY="367.333" alt="">
    <img class="elementos drag" id="drag2" data-id="2" src="./img/pagina07/drag2.png" data-posX="600.91" data-posY="442.188" alt="">
    <img class="elementos drag" id="drag3" data-id="3" src="./img/pagina07/drag3.png" data-posX="600.91 " data-posY="292.477 " alt="">
    <img class="elementos drag" id="drag4" data-id="4" src="./img/pagina07/drag4.png" data-posX="600.91" data-posY="217.622 " alt="">    

    <img class="elementos " id="botonValidar"  src="./img/pagina07/botonVerificar.png" data-posX="756.283" data-posY="480" alt="">
    <img class="elementos " id="avanzar"  src="./img/pagina07/avanzar.png" data-posX="800" data-posY="465.609" alt="">
    <img class="elementos " id="retroBien"  src="./img/pagina07/retroBien.png" data-posX="0" data-posY="0" alt="">
    <img class="elementos " id="retroMal"  src="./img/pagina07/retroMal.png" data-posX="0" data-posY="0" alt="">
    <img class="elementos " id="botonReintentar"  src="./img/pagina07/btnReintentar.png" data-posX="442.529" data-posY="430" alt="">
    <img class="elementos " id="siguiente"  src="./img/pagina07/siguiente.png" data-posX="926.955 " data-posY="480.781 " alt="">

    <style>
        .boton {
            background-color: rgba(167, 255, 108, 0.021);
        }

    </style>

    <!-- Script de la página -->
    <script type="module">

        // Importaciones---------------------------------------------------
        import { aplicacion } from './js/app.js';
        import { animacionEntrada, animacionSalida, parpadea, pararParpadear } from './js/animaciones.js';
        import { cargando } from './js/funciones.js';

        // Audio-----------------------------------------------------------
        const audio = [
            new Audio('./audios/R6_07_1.mp3'),
            new Audio('./audios/R6_07_2.mp3'),
            new Audio('./audios/R6_07_3.mp3'),
        ]

        //Variables--------------------------------------------------------
        const titulo = $('#titulo');       
        const drag1 = $('#drag1');
        const drag2 = $('#drag2');
        const drag3 = $('#drag3');
        const drag4 = $('#drag4');           

        const info01 = $('#info01');
        const info02 = $('#info02');
        const info03 = $('#info03');
        const info04 = $('#info04');
        const info05 = $('#info05');
        const paloma = $('#paloma');
        const tache = $('#tache');
        var botonValidar = $('#botonValidar');
        // const avanzar = $('#avanzar');
        const retroBien = $('#retroBien');
        const retroMal = $('#retroMal');
        const botonReintentar = $('#botonReintentar');
        const siguiente = $('#siguiente');

        const drop1 = $('#drop1');
        const drop2 = $('#drop2');
        const drop3 = $('#drop3');
        const drop4 = $('#drop4');
        

        var bloque1 = false;
        var bloque2 = false;
        var contador1= 0;
        var contador2= 0;

        const elementosDrag = $('.drag');
        const elementosDrop = $('.drop'); 

        let dragSelect;
        let dropCorrespondiente;

        let aciertos = 0;

        let minimoPuntuacion = 4;
        let contadorCorrectos = 0;

        //Al cargar la página
        jQuery(function($){
            cargando(iniciarPagina);
        });

        const iniciarPagina = ()=>{
            aplicacion.reproducirAudio(audio[0], ejercicioPag07, 1000);
            animacionEntrada(titulo, 'izquierda-derecha', 1, 1);    
            animacionEntrada(info01, 'arriba-abajo', 1, 1);
            animacionEntrada(info02, 'arriba-abajo', 1, 1.5);
        }

        const ejercicioPag07 = ()=>{
            animacionEntrada(drag1, 'arriba-abajo', 1, 1);
            animacionEntrada(drag2, 'arriba-abajo', 1, 1);
            animacionEntrada(drag3, 'arriba-abajo', 1, 1);
            animacionEntrada(drag4, 'arriba-abajo', 1, 1);  
            animacionEntrada(drop1, 'default', 1, 1);
            animacionEntrada(drop2, 'default', 1, 1);
            animacionEntrada(drop3, 'default', 1, 1);
            animacionEntrada(drop4, 'default', 1, 1);
            

            relacionar();
        }

        const relacionar = ()=>{
            elementosDrag.draggable({
                revert: false,
                start: function (event, ui) {
                    dragSelect = $(this).data('id');
                    var esteID = $(this).data("id");
                    console.log("Drag seleccionado: " + esteID);
                    
                }
            });

            elementosDrop.droppable({
                accept: ".drag",
                tolerance: "touch",
                drop: function( event, ui ) {
                    dropCorrespondiente = $(this).data('id');
                    verificar();
                    
                }
            });
        }

        const verificar = ()=>{
            contador1++;
            let dragActivo = $(`#drag${dragSelect}`);
            let dropActivo = $(`#drop${dropCorrespondiente}`);

            dragActivo.draggable({
            revert: false,
            });
            dragActivo.draggable("disable");
            dragActivo.css({
            cursor: 'default'
            });

            if (dragSelect === dropCorrespondiente) {
            aciertos++;
            console.log("tengo: " + aciertos+ "aciertos");
            }

            if (contador1 >= 4) {
                parpadea(botonValidar);
                bloque1=true;
            } 
        }

        botonValidar.click(function() {
            if ($(this).css('cursor') == 'pointer') {
                pararParpadear($(this));

                if (bloque1==true) {
                    if (aciertos >= 4) {                       
                        aplicacion.reproducirAudio(audio[1], finalPantalla, 2000);
                        siguiente.hide(); 
                        animacionEntrada(retroBien, 'izquierda-derecha', 1, 1);
                    }
                    else{
                        siguiente.hide(); 
                        animacionEntrada(retroMal, 'izquierda-derecha', 1, 1);
                        aplicacion.reproducirAudio(audio[2], parpadeaReintentar, 2000);
                    }
                }
            }
        });

        const finalPantalla = ()=>{
            aplicacion.terminaPantalla();
        }

        const parpadeaReintentar = ()=>{
            parpadea(botonReintentar);
        }

        botonReintentar.click(function() {
            if ($(this).css('cursor') == 'pointer') {
                pararParpadear($(this));
                aplicacion.recargarPag();
            }
        });    
    </script>

    <!-- Termina Script -->
</body>
</html>