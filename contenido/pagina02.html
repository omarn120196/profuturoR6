<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página 02 | I4L</title>

</head>
<body>
    <img class="elementos" id="titulo" src="./img/pagina02/titulo.png" data-posX="0" data-posY="0" alt="">
    <img class="elementos" id="instrucciones" src="./img/pagina02/instrucciones.png" data-posX="0" data-posY="0" alt="">

    <img class="elementos" id="definicion01" src="./img/pagina02/definicion01.png" data-posX="20" data-posY="110" alt="">
    <img class="elementos" id="definicion02" src="./img/pagina02/definicion02.png" data-posX="20" data-posY="180" alt="">
    <img class="elementos" id="definicion03" src="./img/pagina02/definicion03.png" data-posX="20" data-posY="230" alt="">
    <img class="elementos" id="definicion04" src="./img/pagina02/definicion04.png" data-posX="20" data-posY="280" alt="">
    <img class="elementos" id="definicion05" src="./img/pagina02/definicion05.png" data-posX="20" data-posY="330" alt="">
    <img class="elementos" id="definicion06" src="./img/pagina02/definicion06.png" data-posX="20" data-posY="380" alt="">
    <img class="elementos" id="definicion07" src="./img/pagina02/definicion07.png" data-posX="20" data-posY="430" alt="">
    <img class="elementos" id="definicion08" src="./img/pagina02/definicion08.png" data-posX="20" data-posY="480" alt="">

    <div class="elementos drop" id="drop7" data-id="7" data-posX="540" data-posY="120" style="width:25px;  height:50px;"></div>
    <div class="elementos drop" id="drop8" data-id="8" data-posX="540" data-posY="187" style="width:25px;  height:35px;"></div>
    <div class="elementos drop" id="drop6" data-id="6" data-posX="540" data-posY="237" style="width:25px;  height:35px;"></div>
    <div class="elementos drop" id="drop3" data-id="3" data-posX="540" data-posY="285" style="width:25px;  height:35px;"></div>
    <div class="elementos drop" id="drop5" data-id="5" data-posX="540" data-posY="335" style="width:25px;  height:35px;"></div>
    <div class="elementos drop" id="drop2" data-id="2" data-posX="540" data-posY="388" style="width:25px;  height:35px;"></div>
    <div class="elementos drop" id="drop1" data-id="1" data-posX="540" data-posY="437" style="width:25px;  height:35px;"></div>
    <div class="elementos drop" id="drop4" data-id="4" data-posX="540" data-posY="495" style="width:25px;  height:55px;"></div>

    <img class="elementos drag" id="drag1" data-id="1" src="./img/pagina02/drag01.png" data-posX="570" data-posY="220" alt="">
    <img class="elementos drag" id="drag2" data-id="2" src="./img/pagina02/drag02.png" data-posX="570" data-posY="280" alt="">
    <img class="elementos drag" id="drag3" data-id="3" src="./img/pagina02/drag03.png" data-posX="570" data-posY="340" alt="">
    <img class="elementos drag" id="drag4" data-id="4" src="./img/pagina02/drag04.png" data-posX="570" data-posY="400" alt="">
    <img class="elementos drag" id="drag5" data-id="5" src="./img/pagina02/drag05.png" data-posX="570" data-posY="460" alt="">
    <img class="elementos drag" id="drag6" data-id="6" src="./img/pagina02/drag06.png" data-posX="800" data-posY="280" alt="">
    <img class="elementos drag" id="drag7" data-id="7" src="./img/pagina02/drag07.png" data-posX="800" data-posY="340" alt="">
    <img class="elementos drag" id="drag8" data-id="8" src="./img/pagina02/drag08.png" data-posX="800" data-posY="400" alt="">

    <img class="elementos" id="retroBuena" src="./img/pagina02/retroBuena.png" data-posX="0" data-posY="0" alt="">
    <img class="elementos" id="retroMala" src="./img/pagina02/retroMala.png" data-posX="0" data-posY="0" alt="">
    <img class="elementos" id="btnReintentar" src="./img/pagina02/btnReintentar.png" data-posX="790" data-posY="430" alt="">

    <!-- Script de la página -->
    <script type="module">
        import {aplicacion} from './js/app.js';
        import {animacionEntrada, parpadea} from './js/animaciones.js';
        import {cargando} from './js/funciones.js';

        jQuery(function($){
            
            // Cargar Audios------------------------------------------------------
            const audio = [
                new Audio('./audios/R6_02_1.mp3'),
                new Audio('./audios/R6_02_2.mp3'),
                new Audio('./audios/R6_02_3.mp3'),
            ]

            //Crear Variables-----------------------------------------------------
            const titulo = $('#titulo'); 
            const instrucciones = $('#instrucciones'); 

            const def01 = $('#definicion01'); 
            const def02 = $('#definicion02'); 
            const def03 = $('#definicion03'); 
            const def04 = $('#definicion04'); 
            const def05 = $('#definicion05'); 
            const def06 = $('#definicion06'); 
            const def07 = $('#definicion07'); 
            const def08 = $('#definicion08');

            const drag1 = $('#drag1'); 
            const drag2 = $('#drag2'); 
            const drag3 = $('#drag3'); 
            const drag4 = $('#drag4'); 
            const drag5 = $('#drag5'); 
            const drag6 = $('#drag6'); 
            const drag7 = $('#drag7'); 
            const drag8 = $('#drag8'); 

            const drop1 = $('#drop1'); 
            const drop2 = $('#drop2'); 
            const drop3 = $('#drop3'); 
            const drop4 = $('#drop4'); 
            const drop5 = $('#drop5'); 
            const drop6 = $('#drop6'); 
            const drop7 = $('#drop7'); 
            const drop8 = $('#drop8'); 

            const retroBuena = $('#retroBuena'); 
            const retroMala = $('#retroMala'); 
            const btnReintentar = $('#btnReintentar'); 
            
            //Iniciar contenido de la página--------------------------------------
            cargando(iniciarPagina);

            function iniciarPagina(){
                aplicacion.activarNavegacion();

                aplicacion.reproducirAudio(audio[0], ejercicioPag02, 1000);

                animacionEntrada(titulo, 'izquierda-derecha', 1, 1);
                animacionEntrada(instrucciones, 'izquierda-derecha', 1, 1);
                animacionEntrada(def01, 'izquierda-derecha', 1, 1.5);
                animacionEntrada(def02, 'izquierda-derecha', 1, 2);
                animacionEntrada(def03, 'izquierda-derecha', 1, 2.5);
                animacionEntrada(def04, 'izquierda-derecha', 1, 3);
                animacionEntrada(def05, 'izquierda-derecha', 1, 3.5);
                animacionEntrada(def06, 'izquierda-derecha', 1, 4);
                animacionEntrada(def07, 'izquierda-derecha', 1, 4.5);
                animacionEntrada(def08, 'izquierda-derecha', 1, 5);

                animacionEntrada(drag1, 'arriba-abajo', 1, 1.5);
                animacionEntrada(drag2, 'arriba-abajo', 1, 2);
                animacionEntrada(drag3, 'arriba-abajo', 1, 2.5);
                animacionEntrada(drag4, 'arriba-abajo', 1, 3);
                animacionEntrada(drag5, 'arriba-abajo', 1, 3.5);
                animacionEntrada(drag6, 'arriba-abajo', 1, 4);
                animacionEntrada(drag7, 'arriba-abajo', 1, 4.5);
                animacionEntrada(drag8, 'arriba-abajo', 1, 5);

                animacionEntrada(drop1, 'default', 1, 1);
                animacionEntrada(drop2, 'default', 1, 1);
                animacionEntrada(drop3, 'default', 1, 1);
                animacionEntrada(drop4, 'default', 1, 1);
                animacionEntrada(drop5, 'default', 1, 1);
                animacionEntrada(drop6, 'default', 1, 1);
                animacionEntrada(drop7, 'default', 1, 1);
                animacionEntrada(drop8, 'default', 1, 1);
            }

            function ejercicioPag02() {

                const elementosDrag = $('.drag');
                const elementosDrop = $('.drop');

                let dragSelect;
                let dropCorrespondiente;

                let aciertos = 0;
                let disponibles = 8;

                elementosDrag.draggable({
                    revert: true,
                    start: function (event, ui) {
                        dragSelect = $(this).data('id');
                        console.log(dragSelect);
                    }
                });

                elementosDrop.droppable({
                    accept: ".drag",
                    tolerance: "intersect",
                    drop: function (event, ui) {
                        dropCorrespondiente = $(this).data('id');
                        verificarLugar();
                    }
                });

                function verificarLugar() {

                    if (dragSelect === dropCorrespondiente) {
                        let dragActivo = $(`#drag${dragSelect}`);
                        let dropActivo = $(`#drop${dropCorrespondiente}`);

                        dragActivo.draggable({
                            revert: false,
                        });

                        dragActivo.draggable("disable");

                        dragActivo.css({
                            cursor: 'default'
                        });

                        aciertos++;
                        disponibles --;
                        console.log("aciertos:", aciertos);
                        console.log("disponibles:", disponibles);

                        if (disponibles === 0){
                            evaluar();
                        }

                    } else {
                        let dragActivo = $(`#drag${dragSelect}`);
                        let dropActivo = $(`#drop${dropCorrespondiente}`);

                        setTimeout(() => {
                            dragActivo.remove();
                        }, 500);

                        // dragActivo.draggable({
                        //     revert: true,
                        // });

                        // dragActivo.draggable("disable");

                        // dragActivo.css({
                        //     cursor: 'default'
                        // });

                        disponibles--;
                        console.log("disponibles:", disponibles);

                        if (disponibles === 0) {
                            evaluar();
                        }
                    }
                }

                function evaluar() {
                    if (aciertos == 8) {
                        retroalimentacionBuena();
                    } else {
                        retroalimentacionMala();
                    }
                }
            }

            function retroalimentacionBuena() {
                aplicacion.reproducirAudio(audio[1], terminaPagina, 1000);
                animacionEntrada(retroBuena, 'arriba-abajo', 1, 1);

                function terminaPagina(){
                    aplicacion.nextPag();
                }
            }

            function retroalimentacionMala(){
                aplicacion.reproducirAudio(audio[2], reintentar, 1000);
                animacionEntrada(retroMala, 'arriba-abajo', 1, 1);

                function reintentar() {
                    parpadea(btnReintentar);
                    btnReintentar.click(function () {
                        TweenMax.killTweensOf(btnReintentar);
                        aplicacion.recargarPag();
                    });
                }
            }
        });
    </script>

    <!-- Termina Script -->
</body>
</html>